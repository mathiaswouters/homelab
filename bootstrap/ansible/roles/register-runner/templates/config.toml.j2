concurrent = {{ runner_concurrent | default(1) }}
check_interval = {{ runner_check_interval | default(0) }}

[session_server]
  session_timeout = {{ runner_session_timeout | default(1800) }}

[[runners]]
  name = "{{ runner_name | default('shell-runner') }}"
  url = "{{ gitlab_url }}"
  token = "{{ gitlab_runner_token }}"
  executor = "{{ runner_executor | default('shell') }}"
  
  [runners.custom_build_dir]
  
  [runners.cache]
    [runners.cache.s3]
    [runners.cache.gcs]
    [runners.cache.azure]

{% if runner_executor == 'docker' %}
  [runners.docker]
    tls_verify = false
    image = "{{ runner_docker_image | default('alpine:latest') }}"
    privileged = {{ runner_docker_privileged | default('false') | lower }}
    disable_entrypoint_overwrite = false
    oom_kill_disable = false
    disable_cache = false
    volumes = {{ runner_docker_volumes | default(['/cache']) | to_json }}
    shm_size = 0
{% endif %}

{% if runner_executor == 'shell' %}
  [runners.shell]
    shell = "{{ runner_shell | default('bash') }}"
{% endif %}

{% if runner_executor == 'kubernetes' %}
  [runners.kubernetes]
    host = "{{ runner_kubernetes_host | default('') }}"
    namespace = "{{ runner_kubernetes_namespace | default('gitlab-runner') }}"
    privileged = {{ runner_kubernetes_privileged | default('false') | lower }}
    cpu_limit = "{{ runner_kubernetes_cpu_limit | default('1') }}"
    memory_limit = "{{ runner_kubernetes_memory_limit | default('1Gi') }}"
    service_cpu_limit = "{{ runner_kubernetes_service_cpu_limit | default('1') }}"
    service_memory_limit = "{{ runner_kubernetes_service_memory_limit | default('1Gi') }}"
    helper_cpu_limit = "{{ runner_kubernetes_helper_cpu_limit | default('500m') }}"
    helper_memory_limit = "{{ runner_kubernetes_helper_memory_limit | default('512Mi') }}"
{% endif %}